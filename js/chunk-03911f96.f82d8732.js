(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03911f96"],{"2eeb":function(t,a,e){"use strict";e("ba43")},"809b":function(t,a,e){"use strict";e.r(a);e("99af"),e("d81d"),e("ac1f"),e("841c");var i=function(){var t=this,a=t._self._c;return a("div",{staticClass:"m-maps"},[a("div",{ref:"mapView",staticClass:"m-maps-pic"},[t.mapId?a("img",{attrs:{src:t.currentMap}}):a("div",{ref:"mapWrap",staticClass:"m-map__wrap",on:{mousedown:t.handleMouseDown,mousemove:t.handleMouseMove,mouseup:t.handleMouseUp,wheel:t.handleWheel}},[a("div",{ref:"map",staticClass:"m-map__world",style:"left:".concat(0*t.scale.elWidth/100,"px;top:").concat(25*t.scale.elHeight/100,"px;transform-origin: ").concat(t.scale.zoomOriginX,"px ").concat(t.scale.zoomOriginY,"px; transform: scale(").concat(t.scale.meter_zoom,");cursor: ").concat(t.scale.isDragging?"grabbing":"grab")},[t._l(t.mapData,(function(e,i){return a("span",{key:i,staticClass:"u-map",style:"left:".concat(e.x||0,"px;top:").concat(e.y||0,"px"),on:{click:function(a){return t.changeMap(e.mapid)}}},[t._v(" "+t._s(e.comment)+" ")])})),a("img",{staticClass:"u-img",attrs:{src:t.map,alt:"世界地图"}}),a("img",{staticClass:"u-traffic",attrs:{src:t.traffic,alt:"交通路线"}})],2)])]),a("div",{staticClass:"m-toolbar"},[a("h1",{staticClass:"m-maps__title"},[t._v(t._s(t.title))]),a("el-input",{attrs:{size:"small",clearable:""},model:{value:t.search,callback:function(a){t.search=a},expression:"search"}},[a("template",{slot:"prepend"},[t._v("地图")])],2),a("el-button-group",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-arrow-left"},on:{click:function(a){return t.changePage("prev")}}},[t._v("上一页")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.changePage("next")}}},[t._v(" 下一页 "),a("i",{staticClass:"el-icon-arrow-right el-icon--right"})])],1),a("div",{staticClass:"u-world-map",on:{click:function(a){return t.changeMap(0)}}},[t._v("世界地图")]),a("div",{class:[{mapId:t.mapId},"m-mapList"]},t._l(t.maps,(function(e){return a("div",{key:e.ID,class:["u-item",{active:e.ID==t.mapId}],attrs:{label:e.MapName,value:e.ID},on:{click:function(a){return t.changeMap(e.ID)}}},[t._v(" "+t._s(e.MapName||e.Name)+" ")])})),0)],1)])},n=[],c=(e("4de4"),e("caad"),e("d3b7"),e("2532"),e("c7eb")),s=e("1da1"),r=e("41cb"),o=Object(r["c"])(),l=function(){var t=Object(s["a"])(Object(c["a"])().mark((function t(a){return Object(c["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",o.get("/map",{params:a}));case 1:case"end":return t.stop()}}),t)})));return function(a){return t.apply(this,arguments)}}(),p=function(){var t=Object(s["a"])(Object(c["a"])().mark((function t(a){return Object(c["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",o.get("/map/map-point",{params:a}));case 1:case"end":return t.stop()}}),t)})));return function(a){return t.apply(this,arguments)}}(),u=e("65c2"),m={name:"Map",data:function(){return{loading:!1,mapId:0,maps:[],mapData:[],search:"",page:1,per:17,count:0,title:"",scale:{initWidth:0,initHeight:0,elWidth:0,elHeight:0,meter_zoom:.28,isDragging:!1,dragStartX:0,dragStartY:0,zoomOriginX:0,zoomOriginY:0,click:!1}}},computed:{currentMap:function(){return"".concat(u["__imgPath"],"map/maps/map_").concat(this.mapId,"_0.png")},map:function(){return"".concat(u["__imgPath"],"topic/pic/map.jpg?123")},traffic:function(){return"".concat(u["__imgPath"],"topic/pic/traffic.png?123")},client:function(){return this.$store.state.client},params:function(){var t={per:this.per,page:this.page,client:this.client};return this.search&&(t.search=this.search),t}},watch:{params:{deep:!0,handler:function(){this.load()}},mapId:function(t){null!==t&&""!==t&&void 0!==t||(this.mapId=0);var a=this.maps.filter((function(a){return a.ID==t}))[0],e=this.mapData.filter((function(a){return a.mapid==t}))[0];this.title=(null===a||void 0===a?void 0:a.MapName)||(null===e||void 0===e?void 0:e.comment)||"世界地图"}},mounted:function(){this.load(),this.loadOther(),this.initBodySize()},methods:{changeMap:function(t){this.mapId=t||0,this.scale=this.$options.data().scale},changePage:function(t){var a=this.page;"prev"===t?a--:a<this.count/this.per&&a++,this.page=a<0?0:a},load:function(){var t=this;this.loading=!0,l(this.params).then((function(a){var e=a.data.data.list||[];t.count=a.data.data.count,t.maps=e.map((function(t){return t.ID||(t.MapName="世界地图"),t}))})).finally((function(){t.loading=!0}))},loadOther:function(){var t=this;p({client:this.client}).then((function(a){var e=a.data.data.city||[];t.mapData=e.filter((function(t){var a;return t.comment&&!(null!==(a=t.comment)&&void 0!==a&&a.includes("测试"))}))}))},handleWheel:function(t){var a=this.scale,e=a.meter_zoom,i=a.click,n=a.isDragging;if(!n){var c=t.deltaY||t.deltaX,s=.05;c<0?(e+=s,e>1.8&&(e=1.8)):(e-=s,e<.28&&(e=.28));var r=this.$refs.map.getBoundingClientRect(),o=i?Math.floor(t.clientX-r.right*e):0,l=i?Math.floor(t.clientY-r.bottom*e):0;this.$refs.map.style.transformOrigin="".concat(o,"px ").concat(l,"px"),this.$refs.map.style.transform="scale(".concat(e,")"),this.scale.zoomOriginX=o,this.scale.zoomOriginY=l,this.scale.meter_zoom=e,t.preventDefault()}},initBodySize:function(){var t=4920,a=3456,e=this.scale,i=e.initWidth,n=e.initHeight,c=e.elWidth;i=this.$refs.mapView.clientWidth,n=i*(a/t),c=i*(100/(t/2)),this.scale.initHeight=n,this.scale.elWidth=c,this.scale.elHeight=n*(100/(a/2))},handleMouseDown:function(t){this.scale.isDragging=!0,this.scale.click=!0,this.scale.dragStartX=t.clientX,this.scale.dragStartY=t.clientY},handleMouseMove:function(t){var a=this.scale,e=a.isDragging,i=a.dragStartX,n=a.dragStartY;if(e){var c=t.clientX-i,s=t.clientY-n,r=this.$refs.map;r.style.left="".concat(parseFloat(r.style.left)+c,"px"),r.style.top="".concat(parseFloat(r.style.top)+s,"px"),this.scale.dragStartX=t.clientX,this.scale.dragStartY=t.clientY}},handleMouseUp:function(){this.scale.isDragging=!1}}},h=m,d=(e("2eeb"),e("2877")),f=Object(d["a"])(h,i,n,!1,null,null,null);a["default"]=f.exports},ba43:function(t,a,e){}}]);
//# sourceMappingURL=chunk-03911f96.f82d8732.js.map