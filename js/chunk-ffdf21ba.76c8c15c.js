(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ffdf21ba"],{"6f9c":function(t,e,a){"use strict";a("a149")},"809b":function(t,e,a){"use strict";a.r(e);a("99af"),a("caad"),a("d81d"),a("ac1f"),a("2532"),a("841c"),a("a573");var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-maps"},[t.mapId?e("div",{staticClass:"m-map-other"},[e("img",{staticClass:"m-map-other_img",attrs:{src:t.currentMap}})]):e("div",{staticClass:"m-maps-pic"},[e("dragWrap",{attrs:{data:t.scale},on:{change:t.wrapScaleChange}},[e("div",{staticClass:"m-map__world"},[t._l(t.maps,(function(a,i){return[a.szDisplayName.includes("战乱")||a.szDisplayName.includes("乱世")?t._e():e("div",{key:i,staticClass:"u-map",style:"left:".concat(a.Left||0,"px;top:").concat(a.Top||0,"px"),on:{click:function(e){return t.showChild(a,i)},touchstart:function(e){return t.showChild(a,i)}}},[e("div",{staticClass:"u-map-city_name",style:{transform:"scale(".concat(t.worldMapTextScale,")")}},[e("img",{staticClass:"u-item_bg",style:{opacity:t.visible&&t.selectMapOptions.actId==i?1:0},attrs:{src:t.getIcon("newworldmap_03_10")}}),e("span",{staticClass:"u-item_text"},[t._v(t._s(a.szDisplayName))])]),e("img",{staticClass:"u-map-city_img",attrs:{src:a.szButtonShowImg,draggable:"false"}})])]})),e("img",{staticClass:"u-img",attrs:{src:t.map,alt:"世界地图"},on:{click:function(e){t.visible=!1},touchstart:function(e){t.visible=!1}}}),e("img",{staticClass:"u-traffic",attrs:{src:t.traffic,alt:"交通路线"}})],2)]),e("div",{staticClass:"m-select-box",class:{"m-select-box__hide":!t.visible}},[e("div",{staticClass:"m-select__item"},[e("div",{staticClass:"u-item-title"},[e("img",{staticClass:"u-img",attrs:{src:t.getIcon("newworldmap_03_39")}}),e("span",{staticClass:"u-text"},[t._v("周边城镇")])]),t.selectMapCityOptions.maxCurrent?e("div",{staticClass:"m-select-arrow-box"},[1!=t.selectMapCityOptions.current?e("img",{staticClass:"u-item-arrow u-item-arrow_left",attrs:{src:t.getIcon("newworldmap_03_29")},on:{click:function(e){return t.selectMapChange("after","city")}}}):e("img",{staticClass:"u-item-arrow u-item-arrow_left u-item-arrow_dis",attrs:{src:t.getIcon("newworldmap_03_31")}})]):t._e(),e("div",{staticClass:"u-item-option"},[t._l(t.selectMap.city,(function(a,i){return[i>=t.selectMapCityOptions.after&&i<t.selectMapCityOptions.before?e("div",{key:i,staticClass:"u-item",style:{backgroundImage:"url(".concat(t.getIcon("newworldmap_03_33"),")")},on:{click:function(e){return t.showMap(a)}}},[e("img",{staticClass:"u-img",attrs:{src:a.szButtonShowImg}}),e("span",{staticClass:"u-text"},[t._v(t._s(a.szShowName||a.szComment))])]):t._e()]}))],2),t.selectMapCityOptions.maxCurrent?e("div",{staticClass:"m-select-arrow-box"},[t.selectMapCityOptions.current!=t.selectMapCityOptions.maxCurrent?e("img",{staticClass:"u-item-arrow u-item-right",attrs:{src:t.getIcon("newworldmap_03_25")},on:{click:function(e){return t.selectMapChange("before","city")}}}):e("img",{staticClass:"u-item-arrow u-item-right u-item-arrow_dis",attrs:{src:t.getIcon("newworldmap_03_28")}})]):t._e()]),t.selectMap.fb.length?e("div",{staticClass:"m-select__item"},[e("div",{staticClass:"u-item-title"},[e("img",{staticClass:"u-img",attrs:{src:t.getIcon("newworldmap_03_39")}}),e("span",{staticClass:"u-text"},[t._v("周边秘境")])]),t.selectMapOptions.maxCurrent?e("div",{staticClass:"m-select-arrow-box"},[1!=t.selectMapOptions.current?e("img",{staticClass:"u-item-arrow u-item-arrow_left",attrs:{src:t.getIcon("newworldmap_03_29")},on:{click:function(e){return t.selectMapChange("after","fb")}}}):e("img",{staticClass:"u-item-arrow u-item-arrow_left u-item-arrow_dis",attrs:{src:t.getIcon("newworldmap_03_31")}})]):t._e(),e("div",{staticClass:"u-item-option"},[t._l(t.selectMap.fb,(function(a,i){return[i>=t.selectMapOptions.after&&i<t.selectMapOptions.before?e("div",{key:i,staticClass:"u-item",style:{backgroundImage:"url(".concat(t.getIcon("newworldmap_03_33"),")")},on:{click:function(e){return t.showMap(a)}}},[e("img",{staticClass:"u-img",attrs:{src:a.szButtonShowImg}}),e("span",{staticClass:"u-text"},[t._v(t._s(a.szShowName||a.szComment))])]):t._e()]}))],2),t.selectMapOptions.maxCurrent?e("div",{staticClass:"m-select-arrow-box"},[t.selectMapOptions.current!=t.selectMapOptions.maxCurrent?e("img",{staticClass:"u-item-arrow u-item-right",attrs:{src:t.getIcon("newworldmap_03_25")},on:{click:function(e){return t.selectMapChange("before","fb")}}}):e("img",{staticClass:"u-item-arrow u-item-right u-item-arrow_dis",attrs:{src:t.getIcon("newworldmap_03_28")}})]):t._e()]):t._e()]),t.selectMap.city.length?e("div",{staticClass:"m-resource-box",class:{"m-resource-box__hide":!t.visible}},[t._l(t.natural[t.selectMap.city[0].dwMapID],(function(a,i){return[e("div",{key:i,staticClass:"m-resource__item"},[e("div",{staticClass:"u-item__title"},[e("span",[t._v(t._s(i))])]),t._l(a,(function(a,i){return e("div",{key:i,staticClass:"u-item__list"},[e("span",[t._v(t._s(a))])])}))],2)]}))],2):t._e()],1),e("div",{staticClass:"m-toolbar"},[e("h1",{staticClass:"m-maps__title"},[t._v(t._s(t.title))]),e("el-input",{attrs:{size:"small",clearable:""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}},[e("template",{slot:"prepend"},[t._v("地图")])],2),e("div",{staticClass:"u-world-map",on:{click:t.changeWorldMap}},[t._v("世界地图")]),e("div",{class:[{mapId:t.mapId},"m-mapList"]},t._l(t.showList,(function(a){return e("div",{key:a.ID,class:["u-item",{active:a.ID==t.mapId}],attrs:{label:a.MapName,value:a.ID},on:{click:function(e){return t.changeMap(a.ID)}}},[t._v(" "+t._s(a.MapName)+" ")])})),0)],1),e("div",{staticClass:"m-mobile-layout"},[e("div",{staticClass:"m-mobile-header"},[e("h1",{staticClass:"m-mobile_maps__title"},[t._v(t._s(t.title))]),e("div",{staticClass:"m-drawer_open",on:{click:function(e){t.mobileMapListDrawer=!0}}},[t._v(" 所有地图 "),e("i",{staticClass:"el-icon-search el-icon--right"})])]),e("div",{staticClass:"m-mobile-toolbar"},[e("el-drawer",{attrs:{title:"所有地图",visible:t.mobileMapListDrawer},on:{"update:visible":function(e){t.mobileMapListDrawer=e}}},[e("div",{staticClass:"m-m-drawer-body"},[e("el-input",{attrs:{size:"small",clearable:""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}},[e("template",{slot:"prepend"},[t._v("地图")])],2),e("div",{staticClass:"m-m-drawer-map m-m-item",on:{click:function(e){t.mobileMapListDrawer=!1,t.changeWorldMap()}}},[t._v(" 世界地图 ")]),e("div",{class:[{mapId:t.mapId},"m-m-mapList"]},t._l(t.mapsList,(function(a){return e("div",{key:a.ID,class:["m-m-item",{active:a.ID==t.mapId}],attrs:{label:a.MapName,value:a.ID},on:{click:function(e){t.mobileMapListDrawer=!1,t.changeMap(a.ID)}}},[t._v(" "+t._s(a.MapName)+" ")])})),0)],1)])],1)])])},s=[],n=a("5530"),r=(a("4de4"),a("14d9"),a("fb6a"),a("d3b7"),a("5319"),a("0643"),a("2382"),a("4e3e"),a("159b"),a("c7eb")),c=a("1da1"),o=a("41cb"),l=Object(o["c"])(),p=function(){var t=Object(c["a"])(Object(r["a"])().mark((function t(e){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",l.get("/map/worldmap",{params:e}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),u=function(){var t=Object(c["a"])(Object(r["a"])().mark((function t(e){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",l.get("/map",{params:e}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=a("85e4"),h=a("65c2"),d=function(){var t=this,e=t._self._c;return e("div",{ref:"container",staticClass:"p-map",on:{mousedown:t.startDrag,mousemove:t.drag,mouseup:t.stopDrag,mouseleave:t.stopDrag,touchstart:function(e){return e.preventDefault(),t.startDrag.apply(null,arguments)},touchmove:function(e){return e.preventDefault(),t.drag.apply(null,arguments)},touchend:function(e){return e.preventDefault(),t.stopDrag.apply(null,arguments)},touchcancel:function(e){return e.preventDefault(),t.stopDrag.apply(null,arguments)}}},[e("div",{ref:"map",staticClass:"m-list",style:{transform:"translate(".concat(t.position.x,"px, ").concat(t.position.y,"px) scale(").concat(t.scale,")"),transition:t.isDragging?"":"0.5s all"},on:{click:t.preventClick}},[t._t("default")],2)])},f=[],g=a("2909"),v={name:"dragWrap",props:{data:{type:Object,default:function(){return{}}}},data:function(){return{scale:1,isDragging:!1,startPosition:{x:0,y:0},offset:{x:0,y:0},position:{x:0,y:0},velocity:{x:0,y:0},lastPosition:{x:0,y:0},lastTime:0,dampingFactor:.9,momentumMultiplier:0,containerBounds:null,isIpad:window.innerWidth<1133}},watch:{data:{handler:function(t){var e=t.x,a=t.y,i=t.scale;e&&(this.position.x=e,this.position.y=a,this.scale=i)},deep:!0,immediate:!0}},mounted:function(){var t=this;this.$nextTick((function(){var e=t.$refs.map;e.addEventListener("wheel",t.handleScroll),t.containerBounds=t.$refs.container.getBoundingClientRect(),window.addEventListener("resize",t.updateContainerBounds);var a=document.getElementsByTagName("img");Object(g["a"])(a).forEach((function(t){t.addEventListener("dragstart",(function(t){t.preventDefault()}))}))}))},methods:{startDrag:function(t){this.isDragging=!0,this.isIpad?(this.startPosition.x=t.changedTouches[0].clientX,this.startPosition.y=t.changedTouches[0].clientY):(this.startPosition.x=t.clientX,this.startPosition.y=t.clientY),this.offset.x=this.startPosition.x-this.position.x,this.offset.y=this.startPosition.y-this.position.y,this.velocity.x=0,this.velocity.y=0,this.lastTime=Date.now(),this.lastPosition.x=this.startPosition.x,this.lastPosition.y=this.startPosition.y},drag:function(t){if(this.isDragging){var e,a,i=Date.now(),s=i-this.lastTime;this.isIpad?(e=t.changedTouches[0].clientX,a=t.changedTouches[0].clientY):(e=t.clientX,a=t.clientY),this.velocity.x=(e-this.lastPosition.x)/s,this.velocity.y=(a-this.lastPosition.y)/s,this.position.x=e-this.offset.x,this.position.y=a-this.offset.y,this.lastTime=i,this.lastPosition.x=e,this.lastPosition.y=a,this.updateMomentumMultiplier(e,a)}},stopDrag:function(t){this.isDragging=!1,this.applyMomentum()},updateMomentumMultiplier:function(t,e){var a=Math.sqrt(Math.pow(t-this.startPosition.x,2)+Math.pow(e-this.startPosition.y,2));this.momentumMultiplier=.01*a},applyMomentum:function(){var t=this,e=function(){t.position.x+=t.velocity.x*t.momentumMultiplier,t.position.y+=t.velocity.y*t.momentumMultiplier,(Math.abs(t.velocity.x)>.1||Math.abs(t.velocity.y)>.1)&&(t.velocity.x*=t.dampingFactor,t.velocity.y*=t.dampingFactor,requestAnimationFrame(e))};requestAnimationFrame(e)},updateContainerBounds:function(){this.containerBounds=this.$refs.container.getBoundingClientRect()},preventClick:function(t){this.isDragging&&t.stopPropagation()},handleScroll:function(t){var e=t.deltaY||t.detail||t.wheelDelta,a=.05;e<0?(this.scale+=a,this.scale>1&&(this.scale=1)):(this.scale-=a,this.scale<.35&&(this.scale=.35)),this.$emit("change",this.scale),t.preventDefault()}},beforeDestroy:function(){window.removeEventListener("wheel",this.handleScroll),window.removeEventListener("resize",this.updateContainerBounds)}},w=v,_=a("2877"),y=Object(_["a"])(w,d,f,!1,null,null,null),C=y.exports,M=a("2ef0"),b={name:"Map",components:{dragWrap:C},data:function(){return{loading:!1,mapId:0,city:[],fb:[],maps:[],mapsList:[],search:"",children:[],visible:!1,scale:{x:-122,y:-1400,scale:.35},selectMap:{city:[],fb:[]},selectMapOptions:{current:1,maxCurrent:0,after:0,before:0},selectMapCityOptions:{current:1,maxCurrent:0,after:0,before:0},mobileMapListDrawer:!1,isPhone:window.innerWidth<720,isIpad:window.innerWidth<1133,natural:{},worldMapTextScale:1}},computed:{currentMap:function(){return"".concat(h["__imgPath"],"map/maps/map_").concat(this.mapId,"_0.png")},map:function(){return"".concat(h["__imgPath"],"topic/pic/map.jpg")},traffic:function(){return"".concat(h["__imgPath"],"topic/pic/traffic.png")},client:function(){return this.$store.state.client},_search:function(){return{"no-page":1,"field-no-null-only":"Tip",fields:"Tip,ID,MapName,MapType"}},showList:function(){var t=this;return this.search?this.mapsList.filter((function(e){return e.MapName.indexOf(t.search)>-1})):this.mapsList},title:function(){var t=this;return this.mapId?this.mapsList.filter((function(e){return e.ID==t.mapId}))[0].MapName:"世界地图"}},mounted:function(){this.load(!0),this.wrapScaleChange(this.scale.scale)},methods:{changeMap:function(t){this.visible=!1,this.mapId=t||0},showMap:function(t){var e=t.dwMapID;this.changeMap(e)},changeWorldMap:function(){this.mapId=0,this.search="",this.scale=Object(n["a"])(Object(n["a"])({},this.$options.data().scale),{},{map:Math.random()})},load:function(t){var e=this;this.loading=!0,p().then((function(t){var a=t.data.data||[],i=a.zoning,s=a.city,n=a.copy;e.city=s||[],e.fb=n||[],e.maps=i.filter((function(t){return t.szDisplayName})).map((function(t){return t.szButtonShowImg=e.getGoMapImg(t),t}))})).finally((function(){e.loading=!0})),u(this._search).then((function(a){var i=a.data.data.list||[];e.mapsList=i.reverse(),i.length&&e.trNatural(i),t&&e.isPhone&&e.mapsList.length&&e.changeMap(e.mapsList[0].ID)}))},trNatural:function(t){var e=Object(M["keyBy"])(t,"ID"),a={};for(var i in e)if(e.hasOwnProperty(i)){var s,n=(null===(s=Object(m["e"])(e[i]["Tip"])[0])||void 0===s?void 0:s.text)+"";n=n.replace(/\\/g,"");var r=n.split("n").filter(Boolean),c={},o=r.indexOf("矿物："),l=r.indexOf("草药："),p=r.indexOf("牧草：");c["矿物"]=r.slice(o+1,l),c["草药"]=-1===p?r.slice(l+1):r.slice(l+1,p),-1!==p&&(c["牧草"]=r.slice(p+1)),a[i]=c}this.natural=a},showChild:function(t,e){var a=this,i=t.szChildCityMaps,s=t.szChildCopyMaps,n=t.Left,r=t.Top;this.isIpad?this.scale={x:4920-n-2550,y:3456-r-3150,scale:1}:this.scale={x:4920-n-2444,y:3456-r-3150,scale:1},this.wrapScaleChange(this.scale.scale);var c=[],o=[];i&&i.length&&(c=this.city.filter((function(t){return i.includes(t.dwMapID)}))),s&&s.length&&(o=this.fb.filter((function(t){return s.includes(t.dwMapID)})));var l=c.concat(o).filter((function(t){return t.szComment}))||[];if(l.length){this.children=Object(M["uniqBy"])(l,"dwMapID");var p={city:[],fb:[]};l.forEach((function(t){t.szButtonShowImg=a.getGoMapImg(t),"szVersion"in t?p.fb.push(t):p.city.push(t)})),this.selectMap=p;var u=this.isIpad?4:6,m=Math.max(u-this.selectMap.city.length,1);this.selectMap.fb.length>m?this.selectMapOptions={current:1,maxCurrent:Math.ceil(this.selectMap.fb.length/m),value:m,after:0,before:m}:this.selectMapOptions={after:0,before:this.selectMap.fb.length,maxCurrent:0};var h=Math.min(2,this.selectMap.city.length);this.selectMap.city.length>2?this.selectMapCityOptions={current:1,maxCurrent:Math.ceil(this.selectMap.city.length/2),value:h,after:0,before:h}:this.selectMapCityOptions={after:0,before:this.selectMap.city.length,maxCurrent:0},this.selectMapOptions.actId=e,this.visible=!0}},selectMapChange:function(t,e){var a="city"===e?this.selectMapCityOptions:this.selectMapOptions;"after"===t?(a.current--,a.after-=a.value,a.before-=a.value):"before"===t&&(a.current++,a.after+=a.value,a.before+=a.value)},wrapScaleChange:function(t){var e=.35,a=2.35,i=1,s=1,n=(s-a)/(i-e),r=a-n*e;this.worldMapTextScale=n*(1*t)+r},getGoMapImg:function(t){var e="";e=t.szButtonImg.includes(".UITex")?t.szButtonImg.substring(t.szButtonImg.indexOf("NewWorldMap"),t.szButtonImg.lastIndexOf(".UITex")).concat("_",t.nFrame):"NewWorldMap/fb/".concat(t.szButtonImg);var a=e.toLowerCase();return"".concat(h["__imgPath"],"map2/std/").concat(a,".png")},getIcon:function(t){return"".concat(h["__imgPath"],"map2/std/newworldmap/").concat(t,".png")}}},x=b,I=(a("6f9c"),Object(_["a"])(x,i,s,!1,null,null,null));e["default"]=I.exports},a149:function(t,e,a){}}]);
//# sourceMappingURL=chunk-ffdf21ba.76c8c15c.js.map